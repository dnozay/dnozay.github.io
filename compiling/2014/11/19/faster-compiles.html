<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Chair mounted jousting and inotify...</title><meta name="viewport" content="width=device-width"><!-- build:js /js/main.23ed95cc.js --><script src="/jquery/dist/jquery.07c725a6.js"></script><script src="/sass-bootstrap/dist/js/bootstrap.8973ad7b.js"></script><script src="/js/holder.js"></script><!-- endbuild --><!-- build:css /css/main.ebf52df5.css --><link rel="stylesheet" href="/sass-bootstrap/dist/css/bootstrap.73e1baae.css"><link rel="stylesheet" href="/font-awesome/css/font-awesome.9c8136ee.css"><link rel="stylesheet" href="/css/syntax.74be1697.css"><link rel="stylesheet" href="/css/main.ebf52df5.css"><!-- endbuild --></head><body><!-- Static navbar --><div class="navbar navbar-default navbar-static-top" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span> <i class="fa fa-bars"></i></button> <a class="navbar-brand" href="#">dnozay.github.io</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href="/about.html">About</a></li><li><a href="/test.html">test page</a></li></ul></div><!--/.nav-collapse --></div></div><div class="container"><div class="page-header"><h1>Chair mounted jousting and inotify... <small>19 Nov 2014 <a href="/compiling/2014/11/19/faster-compiles.html"><i class="fa fa-link"></i></a></small></h1></div><div class="post"><p><img src="http://imgs.xkcd.com/comics/compiling.png" alt="chair mounted jousting (xkcd)"></p><p>credit: xkcd <a href="http://xkcd.com/303/">http://xkcd.com/303/</a></p><h1 id="compiling-takes-a-long-time">Compiling takes a long time</h1><ul><li>Maybe you are using <code>make</code>.</li><li>Maybe make is polling the filesystem.</li><li>Maybe you have too many files and too many subdirectories.</li></ul><p>I was recently reviewing some articles about <a href="http://markdalgleish.github.io/presentation-build-wars-gulp-vs-grunt/">build wars</a> and trying to figure out what makes a good and efficient build system. The claim was that using <a href="https://github.com/gulpjs/gulp"><code>gulp</code></a> you have <code>streams</code> and you pipe them all together and the build becomes very efficient. That’s one aspect. Both <code>grunt</code> and <code>gulp</code> support a <code>watch</code> method. Instant feedback is great to have to become more productivity and most sought after. In order to get instant feedback you need to be able to detect changes to your files and be able to perform the minimum amount of work that is required. Why clean objects that are still perfectly valid? Why run <code>make clean</code> at all?</p><p>Nice and fancy, but are the tools that I use daily harnessing that power?</p><h2 id="django-has-runserver">Django has <code>runserver</code></h2><p>At work, I use <code>django</code> in some of the projects. Here is my favorite command:</p><pre><code>./manage.py runserver
</code></pre><p>I have become fond of the <code>autoreload</code> feature. If you look at the <a href="https://github.com/django/django/blob/master/django/utils/autoreload.py"><code>django.utils.autoreload</code></a> code, you will see that it tries to use <a href="http://en.wikipedia.org/wiki/Inotify"><code>inotify</code></a> if it is available.</p><script src="https://gist.github.com/dnozay/91b56b78a1af2d4015f4.js?file=autoreload.py"></script><h2 id="inotify"><code>inotify</code></h2><p>from <a href="http://en.wikipedia.org/wiki/Inotify">Wikipedia</a>:</p><blockquote><p>Inotify (inode notify) is a Linux kernel subsystem that acts to extend filesystems to notice changes to the filesystem, and report those changes to applications. It replaces an earlier facility, dnotify, which had similar goals.</p></blockquote><p>In other words, rather than polling the filesystem to check what new changes came in, the kernel subsystem notifies you. If you have a daemon running for your compile job, it translates in some time spent walking a tree up-front; but a net effect that it does not need to keep doing that each time; later updates are handled more efficiently.</p><h2 id="gulpwatch"><code>gulp.watch</code></h2><p>With <a href="https://github.com/gulpjs/gulp"><code>gulp</code></a> (a build streaming process - written in javascript) allows you to use <code>gulp.watch</code> which monitors file changes and runs the callback functions you provide.</p><script src="https://gist.github.com/dnozay/91b56b78a1af2d4015f4.js?file=gulpsample.js"></script><p>However, <code>gulp.watch</code> is provided by <a href="https://github.com/wearefractal/vinyl-fs"><code>vinyl-fs</code></a> which itself re-exports <code>watch</code> from <a href="https://github.com/wearefractal/glob-watcher"><code>glob-watcher</code></a>, which in turns uses <a href="https://github.com/shama/gaze"><code>gaze</code></a>.</p><h2 id="grunt-contrib-watch"><code>grunt-contrib-watch</code></h2><p>With <a href="https://github.com/gruntjs/grunt"><code>grunt</code></a> you can leverage the <a href="https://github.com/gruntjs/grunt-contrib-watch"><code>grunt-contrib-watch</code></a> plugin which allows you to monitor the file changes.</p><script src="https://gist.github.com/dnozay/91b56b78a1af2d4015f4.js?file=gruntsample.js"></script><p>Just as <code>gulp.watch</code> this also leverages <a href="https://github.com/shama/gaze"><code>gaze</code></a>.</p><h2 id="gaze"><code>gaze</code></h2><p><a href="https://github.com/shama/gaze">https://github.com/shama/gaze</a>:</p><blockquote><p>A globbing fs.watch wrapper built from the best parts of other fine watch libs. Compatible with Node.js 0.10/0.8, Windows, OSX and Linux.</p></blockquote><p><img src="http://dontkry.com/images/repos/gaze.png" alt="gaze"></p><p>Here is a sample from the documentation:</p><script src="https://gist.github.com/dnozay/91b56b78a1af2d4015f4.js?file=gazesample.js"></script><h1 id="back-to-make">Back to <code>make</code></h1><p>I wanted to search if <code>make</code> was able to run as a daemon and use <code>inotify</code>. This is what I found after a bit of googling and searching <a href="http://stackoverflow.com/questions/5110114/">stackoverflow</a>.</p><h2 id="supplementing-make">supplementing <code>make</code></h2><p>Possibilities are to use tools / libraries and teach <code>make</code> about them. These are the contenders…</p><h3 id="inotify-tools"><code>inotify-tools</code></h3><p>quote from the <a href="https://github.com/rvoicilas/inotify-tools"><code>inotify-tools</code> github page</a>:</p><blockquote><p>[inotify-tools] is a package of some commandline utilities relating to inotify.</p><p>The general purpose of this package is to allow inotify’s features to be used from within shell scripts.</p></blockquote><h3 id="fswatch"><code>fswatch</code></h3><p>quote from the <a href="https://github.com/emcrisostomo/fswatch"><code>fswatch</code> github page</a>:</p><blockquote><p>A cross-platform file change monitor with multiple backends: Apple OS X File System Events API, *BSD kqueue, Linux inotify and a stat-based backend.</p></blockquote><h2 id="make-alternatives-using-inotify"><code>make</code> alternatives using <code>inotify</code></h2><p>If <code>make</code> does not support <code>inotify</code> there are some known alternatives that do. It may be tedious to port the Makefiles though; which is why I would look into making <code>make</code> better rather than rip-and-replace with a different solution.</p><h3 id="tup"><code>tup</code></h3><p><strong>What is tup?</strong></p><blockquote><p>Tup is a file-based build system for Linux, OSX, and Windows. It inputs a list of file changes and a directed acyclic graph (DAG), then processes the DAG to execute the appropriate commands required to update dependent files. Updates are performed with very little overhead since tup implements powerful build algorithms to avoid doing unnecessary work. This means you can stay focused on your project rather than on your build system.</p></blockquote><p>After previous discoveries, I tried to look up build systems that leverage <code>inotify</code>; I found <a href="http://gittup.org/tup/"><code>tup</code></a>. The website publishes a comparison between <a href="http://gittup.org/tup/make_vs_tup.html"><code>make</code> and <code>tup</code></a>.</p></div><div class="pagination"><ul class="pager"><li class="previous"><a href="/licensing/2014/10/25/choosing-a-license.html"><i class="fa fa-arrow-left"></i> Previous</a></li><li class="next disabled"><a href="#">Next <i class="fa fa-arrow-right"></i></a></li></ul></div></div><div class="footer"><div class="container text-center"><p>The contents of this website are <i class="fa fa-copyright"></i>&nbsp;2014 <a href="mailto:damiennozay+blog@gmail.com">Damien Nozay</a> under the terms of the <a href="http://opensource.org/licenses/MIT">MIT&nbsp;License</a>.</p><div><p><i class="fa fa-cog fa-spin"></i> Made with love thanks to: <a href="http://fontawesome.io/">Font Awesome</a><span class="hide-xs">·</span> <a href="http://getbootstrap.com/">Bootstrap</a><span class="hide-xs">·</span> <a href="http://jekyllrb.com/">Jekyll</a><span class="hide-xs">·</span> <a href="http://yeoman.io/">Yeoman</a><span class="hide-xs">·</span> <a href="https://github.com">Github</a><span class="hide-xs">·</span> and others...</p>Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a></div></div></div><!-- build:js /js/scripts.js --><script src="/js/main.23ed95cc.js"></script><!-- endbuild --></body></html>